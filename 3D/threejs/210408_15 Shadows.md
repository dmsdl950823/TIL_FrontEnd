# Shadows

ì§€ë‚œ ê°•ì˜ì—ì„œ lightë¥¼ ë§Œë“¤ì—ˆìœ¼ë¯€ë¡œ, ê·¸ë¦¼ì(shadow) ê°€ í•„ìš”í•©ë‹ˆë‹¤. objectì˜ ë’·ë¶€ë¶„ì€ **core shadow** ë¼ê³  ë¶ˆë¦¬ë©°, ì´ë¯¸ ì–´ë‘¡ìŠµë‹ˆë‹¤. ì—¬ê¸°ì—ì„œëŠ” objectê°€ ë˜ë‹¤ë¥¸ object ìœ„ì— ê·¸ë¦¼ìë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” **drop shadow**ê°€ ë¹ ì ¸ìˆìŠµë‹ˆë‹¤.

ê·¸ë¦¼ìëŠ” real-time 3D rendering ì—ì„œëŠ” ë§¤ìš° ì–´ë ¤ìš´ ë¶€ë¶„ì´ê³ , ê°œë°œìë“¤ì€ ì§„ì§œê°™ì€ ê·¸ë§‚ë§ˆë“¤ì„ í•©ë¦¬ì ì¸ frame ì†ë„ë¡œ ë³´ì—¬ì£¼ëŠ” íŠ¸ë¦­ì„ ì°¾ì•„ë‚´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ë¦¼ìë¥¼ êµ¬í˜„í•´ë‚´ëŠ” ë°©ë²•ì€ ë§ê³ , Three.js ëŠ” ë‚´ì¥ ì†”ë£¨ì…˜ì´ ìˆìŠµë‹ˆë‹¤. ì´ í•´ê²°ë²•ì€ ê°„í¸í•˜ì§€ë§Œ ì™„ë²½í•˜ë‹¤ê³  í•˜ê¸°ì—” ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.

# How it works

ì–´ë–»ê²Œ ê·¸ë¦¼ìê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ì— ëŒ€í•´ì„œë³´ë‹¤ëŠ”, ê¸°ì´ˆë¥¼ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.

ì¼ë‹¨ í•˜ë‚˜ë¥¼ ëœë”ë§ í•˜ë©´, Three.js ëŠ” ê·¸ë¦¼ìë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” ê°ê°ì˜ light ë¥¼ ìœ„í•˜ì—¬ renderë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ render í–‰ìœ„ëŠ” lightê°€ ë§ˆì¹˜ camera ê°€ í™”ë©´ì„ ë³´ëŠ” ê²ƒ ê°™ì´ í–‰ë™í•©ë‹ˆë‹¤. (light ê°€ ë¹„ì¶”ëŠ” ë¹›ì´ camera scene ì¸ ê²ƒ ì²˜ëŸ¼ í–‰ë™í•©ë‹ˆë‹¤) ì´ light ê°€ render ë˜ëŠ” ë™ì•ˆ, [MeshDepthMaterial](https://threejs.org/docs/index.html#api/en/materials/MeshDepthMaterial) ëŠ” ëª¨ë“  light cameraì— ë³´ì—¬ì§€ëŠ” mesh ì˜ material ì„ ëŒ€ì²´í•©ë‹ˆë‹¤.

ì´ ê²°ê³¼ëŠ” texture ë¡œ ì €ì¥ë˜ê³  shadow map ì´ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤.

ì´ shadow map ë“¤ì„ ì§ì ‘ì ìœ¼ë¡œ ë³¼ ìˆ˜ëŠ” ì—†ì§€ë§Œ, ê·¸ë¦¼ìë¥¼ ë°›ëŠ” ëª¨ë“  geometryì˜ ëª¨ë“  material ì— ë„í¬ë©ë‹ˆë‹¤.

[DirectionalLight ì™€ SpotLight Three.js ì˜ˆì œ](https://threejs.org/examples/webgl_shadowmap_viewer.html)


# Setup

ì‹œì‘ íŒŒì¼ì—ì„œëŠ” ê°„ë‹¨í•œ planeì— sphere í•˜ë‚˜ì™€ í•˜ë‚˜ì˜ directional light ì™€ ambient light ë¡œ ì´ë£¨ì–´ì ¸ìˆìŠµë‹ˆë‹¤.

light  ì™€ material metalness, roughness ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img src="https://threejs-journey.xyz/assets/lessons/15/step-01.png" width=400>


# How to activate shadows

`renderer` ì— shadow map ì„ í™œì„±í™” ì‹œì¼œì•¼í•©ë‹ˆë‹¤.

``` js
  /**
  * Renderer
  */
  // ...

  // ğŸ§Š
  renderer.shadowMap.enabled = true
```

ê·¸ë¦¬ê³  sceneì˜ ê°ê°ì˜ obect ë¥¼ í™•ì¸í•˜ê³  `castShadow` í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ **objectê°€ ê·¸ë¦¼ìë¥¼ ë§Œë“¤ì–´ ë‚¼ ìˆ˜ ìˆì–´ì•¼ í•˜ëŠ”ì§€**ì— ëŒ€í•´ì„œ ê²°ì •í•©ë‹ˆë‹¤. **objectê°€ ê·¸ë¦¼ìë¥¼ ë°›ëŠ”ë‹¤ë©´** `receiveShadow` í”„ë¡œí¼í‹°ë¥¼ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.

``` js
  /**
  * Objects
  */
  // sphere ...
  sphere.castShadow = true

  // plane ...
  plane.receiveShadow = true
```

ë§ˆì§€ë§‰ìœ¼ë¡œ `castShadow` í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ë¦¼ìë¥¼ light ì— í™œì„±í™” ì‹œì¼œì¤ë‹ˆë‹¤.

ì•„ë˜ íƒ€ì…ì˜ light ê°€ shadow ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

* [PointLight](https://threejs.org/docs/index.html#api/en/lights/PointLight)
* [DirectionalLight](https://threejs.org/docs/index.html#api/en/lights/DirectionalLight)
* [SpotLight](https://threejs.org/docs/index.html#api/en/lights/SpotLight)

ê·¸ë¦¬ê³  shadowë¥¼ ê°€ëŠ¥í•œí•œ ì‘ì€ light ë¹›ì— ê·¸ë¦¼ìë¥¼ í™œì„±í™” ì‹œì¼œì¤ë‹ˆë‹¤.

``` js
  
  /**
  * Lights
  */
  // Ambient light...
  // Directional light...
  directionalLight.castShadow = true
```
<img src="https://threejs-journey.xyz/assets/lessons/15/step-02.png" width=400 />

ì´ì œ plane ê³¼ sphere ì— ê·¸ë¦¼ìë¥¼ ê°–ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê·¸ë¦¼ìê°€ ì¢‹ì•„ë³´ì´ì§€ ì•Šìœ¼ë¯€ë¡œ ê°œì„ ì‹œì¼œì•¼í•©ë‹ˆë‹¤.

# Shadow map optimaizations

## Render Size

ê°•ì˜ì˜ ì‹œì‘ë¶€ë¶„ì—ì„œ, Three.js ëŠ” ê°ê°ì˜ light ë§ˆë‹¤ shadow map ì„ í˜¸ì¶œí•˜ë©° renderë¥¼ í•œë‹¤ê³  í–ˆìŠµë‹ˆë‹¤. ì´ shadow map (ê·¸ë¦¬ê³  ê·¸ ì™¸ì˜ ê²ƒë“¤) ì— `shadow` í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` js
  console.log(directionalLight.shadow)
```

<img src="///"> ì—¬ê¸°ã…£!! ğŸ’‹ğŸ’‹ğŸ§¨ğŸ§¨ğŸ§¨ğŸˆğŸˆ

renderë¥¼ ìœ„í•´ì„œëŠ” size ë¥¼ êµ¬ì²´í™” ì‹œì¼œì•¼í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œëŠ” shadow map sizeëŠ”  í¼í¬ë¨¼ìŠ¤ ë¬¸ì œë¡œ ì¸í•˜ì—¬ `512 * 512`  ì…ë‹ˆë‹¤. ê°œì„ í•  ìˆœ ìˆì§€ë§Œ mipmappingì„ ìœ„í•´ì„œ 2ë°°ë¡œ ëŠ˜ë¦´ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.

``` js
  directionalLight.shadow.mapSize.width = 1024
  directionalLight.shadow.mapSize.height = 1024
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-03.png" width=400>

ê·¸ë¦¼ìëŠ” ì´ì œ ì¡°ê¸ˆ ë‚˜ì•„ì¡ŒìŠµë‹ˆë‹¤.

# Near and Far

Three.js ëŠ” shadow map ëœë”ë§ì„ ìœ„í•´ì„œ (light)cameraë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ (light)cameraëŠ” camera ì™€ ê°™ì€ í”„ë¡œí¼í‹° ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ `near` ê³¼ `far` í”„ë¡œí¼í‹°ë¥¼ ì •ì˜í•´ì•¼í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ê²ƒì€ ê·¸ë¦¼ìì˜ í€„ë¦¬í‹°ë¥¼ ê°œì„ ì‹œí‚¤ì§„ ì•Šì§€ë§Œ, ì„¤ì •í–ˆìœ¼ë‚˜ ê·¸ë¦¼ìê°€ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤ê±°ë‚˜, ì–´ë””ì„ ê°€ ê·¸ë¦¼ìê°€ ê°‘ìê¸° ì˜ë ¤ë³´ì´ëŠ” ë“±ì˜ ë²„ê·¸ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

*(light)* camera ë””ë²„ê¹…ê³¼ `near`, `far` ë¥¼ ë³´ê¸° ìœ„í•´ì„œëŠ”, shadow map ì— ì‚¬ìš©ëœ *(light)* camera ì—  [CameraHelper](https://threejs.org/docs/#api/en/helpers/CameraHelper) ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (*light* camera ëŠ” `directionalLight.shadow.camera` ì— ì •ì˜ë˜ì–´ìˆìŠµë‹ˆë‹¤)


``` js
  // ğŸ’
  const directionalLightCameraHelper = new THREE.CameraHelper(directionalLight.shadow.camera)
  // directionalLightCameraHelper.visible = false

  scene.add(directionalLightCameraHelper)
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-04.png" width=400>

ì´ì œ light camera ì˜ `near` ê³¼ `far` ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. scene ì— ë§ëŠ” ê°’ì„ ì°¾ìœ¼ë ¤ê³  í•´ë³´ì„¸ìš”.

``` js
  directionalLight.shadow.camera.near = 1
  directionalLight.shadow.camera.far = 6
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-05.png" width=400>

# Amplitude

