- [Shadows](#shadows)
- [How it works](#how-it-works)
- [Setup](#setup)
- [How to activate shadows](#how-to-activate-shadows)
- [Shadow map optimaizations](#shadow-map-optimaizations)
  - [Render Size](#render-size)
  - [Near and Far](#near-and-far)
  - [Amplitude](#amplitude)
  - [Blur](#blur)
- [Shadow map algorithm](#shadow-map-algorithm)
- [SpotLight](#spotlight)
- [PointLight](#pointlight)
- [Baking Shadows](#baking-shadows)
- [Baking shadows alternative](#baking-shadows-alternative)
- [Which technique to use](#which-technique-to-use)

# Shadows

ì§€ë‚œ ê°•ì˜ì—ì„œ lightë¥¼ ë§Œë“¤ì—ˆìœ¼ë¯€ë¡œ, ê·¸ë¦¼ì(shadow) ê°€ í•„ìš”í•©ë‹ˆë‹¤. objectì˜ ë’·ë¶€ë¶„ì€ **core shadow** ë¼ê³  ë¶ˆë¦¬ë©°, ì´ë¯¸ ì–´ë‘¡ìŠµë‹ˆë‹¤. ì—¬ê¸°ì—ì„œëŠ” objectê°€ ë˜ë‹¤ë¥¸ object ìœ„ì— ê·¸ë¦¼ìë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” **drop shadow**ê°€ ë¹ ì ¸ìˆìŠµë‹ˆë‹¤.

ê·¸ë¦¼ìëŠ” real-time 3D rendering ì—ì„œëŠ” ë§¤ìš° ì–´ë ¤ìš´ ë¶€ë¶„ì´ê³ , ê°œë°œìë“¤ì€ ì§„ì§œê°™ì€ ê·¸ë§‚ë§ˆë“¤ì„ í•©ë¦¬ì ì¸ frame ì†ë„ë¡œ ë³´ì—¬ì£¼ëŠ” íŠ¸ë¦­ì„ ì°¾ì•„ë‚´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ë¦¼ìë¥¼ êµ¬í˜„í•´ë‚´ëŠ” ë°©ë²•ì€ ë§ê³ , Three.js ëŠ” ë‚´ì¥ ì†”ë£¨ì…˜ì´ ìˆìŠµë‹ˆë‹¤. ì´ í•´ê²°ë²•ì€ ê°„í¸í•˜ì§€ë§Œ ì™„ë²½í•˜ë‹¤ê³  í•˜ê¸°ì—” ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.

# How it works

ì–´ë–»ê²Œ ê·¸ë¦¼ìê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ì— ëŒ€í•´ì„œë³´ë‹¤ëŠ”, ê¸°ì´ˆë¥¼ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤.

ì¼ë‹¨ í•˜ë‚˜ë¥¼ ëœë”ë§ í•˜ë©´, Three.js ëŠ” ê·¸ë¦¼ìë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” ê°ê°ì˜ light ë¥¼ ìœ„í•˜ì—¬ renderë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤. ì´ render í–‰ìœ„ëŠ” lightê°€ ë§ˆì¹˜ camera ê°€ í™”ë©´ì„ ë³´ëŠ” ê²ƒ ê°™ì´ í–‰ë™í•©ë‹ˆë‹¤. (light ê°€ ë¹„ì¶”ëŠ” ë¹›ì´ camera scene ì¸ ê²ƒ ì²˜ëŸ¼ í–‰ë™í•©ë‹ˆë‹¤) ì´ light ê°€ render ë˜ëŠ” ë™ì•ˆ, [MeshDepthMaterial](https://threejs.org/docs/index.html#api/en/materials/MeshDepthMaterial) ëŠ” ëª¨ë“  light cameraì— ë³´ì—¬ì§€ëŠ” mesh ì˜ material ì„ ëŒ€ì²´í•©ë‹ˆë‹¤.

ì´ ê²°ê³¼ëŠ” texture ë¡œ ì €ì¥ë˜ê³  shadow map ì´ë¼ê³  ë¶ˆë¦½ë‹ˆë‹¤.

ì´ shadow map ë“¤ì„ ì§ì ‘ì ìœ¼ë¡œ ë³¼ ìˆ˜ëŠ” ì—†ì§€ë§Œ, ê·¸ë¦¼ìë¥¼ ë°›ëŠ” ëª¨ë“  geometryì˜ ëª¨ë“  material ì— ë„í¬ë©ë‹ˆë‹¤.

[DirectionalLight ì™€ SpotLight Three.js ì˜ˆì œ](https://threejs.org/examples/webgl_shadowmap_viewer.html)


# Setup

ì‹œì‘ íŒŒì¼ì—ì„œëŠ” ê°„ë‹¨í•œ planeì— sphere í•˜ë‚˜ì™€ í•˜ë‚˜ì˜ directional light ì™€ ambient light ë¡œ ì´ë£¨ì–´ì ¸ìˆìŠµë‹ˆë‹¤.

light  ì™€ material metalness, roughness ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img src="https://threejs-journey.xyz/assets/lessons/15/step-01.png" width=400>


# How to activate shadows

`renderer` ì— shadow map ì„ í™œì„±í™” ì‹œì¼œì•¼í•©ë‹ˆë‹¤.

``` js
  /**
  * Renderer
  */
  // ...

  // ğŸ§Š
  renderer.shadowMap.enabled = true
```

ê·¸ë¦¬ê³  sceneì˜ ê°ê°ì˜ obect ë¥¼ í™•ì¸í•˜ê³  `castShadow` í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ **objectê°€ ê·¸ë¦¼ìë¥¼ ë§Œë“¤ì–´ ë‚¼ ìˆ˜ ìˆì–´ì•¼ í•˜ëŠ”ì§€**ì— ëŒ€í•´ì„œ ê²°ì •í•©ë‹ˆë‹¤. **objectê°€ ê·¸ë¦¼ìë¥¼ ë°›ëŠ”ë‹¤ë©´** `receiveShadow` í”„ë¡œí¼í‹°ë¥¼ ì¶”ê°€í•´ì•¼í•©ë‹ˆë‹¤.

``` js
  /**
  * Objects
  */
  // sphere ...
  sphere.castShadow = true

  // plane ...
  plane.receiveShadow = true
```

ë§ˆì§€ë§‰ìœ¼ë¡œ `castShadow` í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ë¦¼ìë¥¼ light ì— í™œì„±í™” ì‹œì¼œì¤ë‹ˆë‹¤.

ì•„ë˜ íƒ€ì…ì˜ light ê°€ shadow ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

* [PointLight](https://threejs.org/docs/index.html#api/en/lights/PointLight)
* [DirectionalLight](https://threejs.org/docs/index.html#api/en/lights/DirectionalLight)
* [SpotLight](https://threejs.org/docs/index.html#api/en/lights/SpotLight)

ê·¸ë¦¬ê³  shadowë¥¼ ê°€ëŠ¥í•œí•œ ì‘ì€ light ë¹›ì— ê·¸ë¦¼ìë¥¼ í™œì„±í™” ì‹œì¼œì¤ë‹ˆë‹¤.

``` js
  
  /**
  * Lights
  */
  // Ambient light...
  // Directional light...
  directionalLight.castShadow = true
```
<img src="https://threejs-journey.xyz/assets/lessons/15/step-02.png" width=400 />

ì´ì œ plane ê³¼ sphere ì— ê·¸ë¦¼ìë¥¼ ê°–ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê·¸ë¦¼ìê°€ ì¢‹ì•„ë³´ì´ì§€ ì•Šìœ¼ë¯€ë¡œ ê°œì„ ì‹œì¼œì•¼í•©ë‹ˆë‹¤.

# Shadow map optimaizations

## Render Size

ê°•ì˜ì˜ ì‹œì‘ë¶€ë¶„ì—ì„œ, Three.js ëŠ” ê°ê°ì˜ light ë§ˆë‹¤ shadow map ì„ í˜¸ì¶œí•˜ë©° renderë¥¼ í•œë‹¤ê³  í–ˆìŠµë‹ˆë‹¤. ì´ shadow map (ê·¸ë¦¬ê³  ê·¸ ì™¸ì˜ ê²ƒë“¤) ì— `shadow` í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•´ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` js
  console.log(directionalLight.shadow)
```

<img src="./threejs_images/15-shadow-directionalLightProps.PNG" width=300>

renderë¥¼ ìœ„í•´ì„œëŠ” size ë¥¼ êµ¬ì²´í™” ì‹œì¼œì•¼í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œëŠ” shadow map sizeëŠ”  í¼í¬ë¨¼ìŠ¤ ë¬¸ì œë¡œ ì¸í•˜ì—¬ `512 * 512`  ì…ë‹ˆë‹¤. ê°œì„ í•  ìˆœ ìˆì§€ë§Œ mipmappingì„ ìœ„í•´ì„œ 2ë°°ë¡œ ëŠ˜ë¦´ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.

``` js
  directionalLight.shadow.mapSize.width = 1024
  directionalLight.shadow.mapSize.height = 1024
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-03.png" width=400>

ê·¸ë¦¼ìëŠ” ì´ì œ ì¡°ê¸ˆ ë‚˜ì•„ì¡ŒìŠµë‹ˆë‹¤.

## Near and Far

Three.js ëŠ” shadow map ëœë”ë§ì„ ìœ„í•´ì„œ (light)cameraë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ (light)cameraëŠ” camera ì™€ ê°™ì€ í”„ë¡œí¼í‹° ë¥¼ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ `near` ê³¼ `far` í”„ë¡œí¼í‹°ë¥¼ ì •ì˜í•´ì•¼í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ê²ƒì€ ê·¸ë¦¼ìì˜ í€„ë¦¬í‹°ë¥¼ ê°œì„ ì‹œí‚¤ì§„ ì•Šì§€ë§Œ, ì„¤ì •í–ˆìœ¼ë‚˜ ê·¸ë¦¼ìê°€ ë³´ì´ì§€ ì•ŠëŠ”ë‹¤ê±°ë‚˜, ì–´ë””ì„ ê°€ ê·¸ë¦¼ìê°€ ê°‘ìê¸° ì˜ë ¤ë³´ì´ëŠ” ë“±ì˜ ë²„ê·¸ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

*(light)* camera ë””ë²„ê¹…ê³¼ `near`, `far` ë¥¼ ë³´ê¸° ìœ„í•´ì„œëŠ”, shadow map ì— ì‚¬ìš©ëœ *(light)* camera ì—  [CameraHelper](https://threejs.org/docs/#api/en/helpers/CameraHelper) ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (*light* camera ëŠ” `directionalLight.shadow.camera` ì— ì •ì˜ë˜ì–´ìˆìŠµë‹ˆë‹¤)


``` js
  // ğŸ’
  const directionalLightCameraHelper = new THREE.CameraHelper(directionalLight.shadow.camera)
  // directionalLightCameraHelper.visible = false

  scene.add(directionalLightCameraHelper)
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-04.png" width=400>

ì´ì œ light camera ì˜ `near` ê³¼ `far` ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. scene ì— ë§ëŠ” ê°’ì„ ì°¾ìœ¼ë ¤ê³  í•´ë³´ì„¸ìš”.

``` js
  directionalLight.shadow.camera.near = 1
  directionalLight.shadow.camera.far = 6
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-05.png" width=400>

## Amplitude

ìš°ë¦¬ê°€ ì¶”ê°€í•œ camera helper ë•ë¶„ì—, ìš°ë¦¬ëŠ” camera ì˜ ë„ˆë¹„ê°€ ë„ˆë¬´ í¬ë‹¤ëŠ”ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

[DirectionalLight](https://threejs.org/docs/#api/en/lights/DirectionalLight) ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, Three.jsëŠ” [OrthographicCamera](https://threejs.org/docs/#api/en/cameras/OrthographicCamera) ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì§€ë‚œ 07 Camera ê°•ì˜ë¥¼ ê¸°ì–µí•œë‹¤ë©´, `top`, `right`, `bottom`, `left` í”„ë¡œí¼í‹°ë¥¼ ì‹œìš©í•´ì„œ ê°ê°ì˜ camera ì˜ ê° ì¸¡ë©´ì„ ì–¼ë§Œí¼ ë©€ë¦¬í• ì§€ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` js
  directionalLight.shadow.camera.top = 2
  directionalLight.shadow.camera.right = 2
  directionalLight.shadow.camera.bottom = - 2
  directionalLight.shadow.camera.left = - 2
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-06.png" width=400>

ë” ì‘ì€ ê°’ê³¼ ë” ì •í™•í•œ ê·¸ë¦¼ìê°€ ë  ê²ƒ ì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ë„ˆë¬´ ì‘ìœ¼ë©´, ê·¸ë¦¼ìê°€ ì˜ë¦´ ìˆ˜ ë„ ìˆìœ¼ë¯€ë¡œ ë§ì€ ì‹¤í—˜ì„ í•˜ëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤.

<img src="./threejs_images/15-shadow-camerahelper.PNG" width=350/>

ì™„ì„±ëœ í›„ì—ëŠ” camera ë¥¼ hide ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` js
  directionalLightCameraHelper.visible = false
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-07.png" width=400>

## Blur

ê·¸ë¦¼ìì˜ blur ë¥¼ ì¡°ì ˆ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` js
  directionalLight.shadow.radius = 10
```

ì´ í…Œí¬ë‹‰ì€ ì¹´ë©”ë¼ì˜ ê·¼ê±°ë¦¬ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ê·¸ëƒ¥ ê°„ë‹¨í•œ ë¸”ëŸ¬ë¥¼ ìƒì„±í•´ì£¼ë¯€ë¡œ ë³´ê¸°ê°€ ì¢‹ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.

<img src="https://threejs-journey.xyz/assets/lessons/15/step-08.png" width=400>

# Shadow map algorithm

shadow map ì—ëŠ” ë‹¤ë¥¸ íƒ€ì…ì˜ ì•Œê³ ë¦¬ì¦˜ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.

| Algorithm                  | Performance | quality                                |
| -------------------------- | ----------- | -------------------------------------- |
| **THREE.BasicShadowMap**   | ë§¤ìš° ë¹ ë¦„   | ì¢‹ì§€ ì•ŠìŒ                              |
| **THREE.PCFShadowMap**     | ì¢‹ì§€ ì•ŠìŒ   | ë¶€ë“œëŸ¬ìš´ ëª¨ì„œë¦¬ë¥¼ ê°€ì§                 |
| **THREE.PCFSoftShadowMap** | ì¢‹ì§€ ì•ŠìŒ   | ë” ë¶€ë“œëŸ¬ìš´ ëª¨ì„œë¦¬ë¥¼ ê°€ì§              |
| **THREE.VSMShadowMap**     | ì¢‹ì§€ ì•ŠìŒ   | ê°€ì¥ ì œì•½ì ìœ¼ê³  ì˜ˆìƒì¹˜ëª»í•œ ê²°ê³¼ë¥¼ ë³´ìœ  |

Shadow map ì„ ë³€ê²½í•˜ê¸° ìœ„í•´ì„œëŠ” `renderer.shadowMap.type` í”„ë¡œí¼í‹°ê°€ í•„ìš”í•©ë‹ˆë‹¤. ê¸°ë³¸ì€ `THREE.PCFShadowMap` ì´ì§€ë§Œ, ë” ì¢‹ì€ í€„ë¦¬í‹°ë¥¼ ìœ„í•´ì„œ `THREE.PCFSoftShadowMap` ì„ ì‚¬ìš©í•  ê²ƒ ì…ë‹ˆë‹¤.

``` js
  // ğŸ§Š
  renderer.shadowMap.enabled = true
  renderer.shadowMap.type = THREE.PCFSoftShadowMap
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-09.png" width=400>

radius í”„ë¡œí¼í‹°ëŠ” `THREE.PCFSoftShadowMap` ì—ì„œ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ”ê²ƒì„ ì—¼ë‘í•´ì•¼í•˜ë¯€ë¡œ, ì„ íƒì„ í•´ì•¼í•©ë‹ˆë‹¤.

# SpotLight

ì´ì „ ê°•ì˜ì²˜ëŸ¼ SpotLight ë¥¼ ì¶”ê°€í•˜ì—¬ `castShadow` í”„ë¡œí¼í‹°ë¥¼ `true` ë¡œ ë§Œë“­ë‹ˆë‹¤. `target` í”„ë¡œí¼í‹°ë„ `scene` ì— ì¶”ê°€ í•˜ëŠ” ê²ƒ ìŠì§€ ë§ˆì„¸ìš”.

``` js
  // ğŸ‡ SpotLight
  const spotLight = new THREE.SpotLight(0xffffff, 0.2, 10, Math.PI * 0.3)
  spotLight.position.set(0, 2, 2)

  spotLight.castShadow = true

  scene.add(spotLight)
  scene.add(spotLight.target)

  const spotLightCameraHelper = new THREE.CameraHelper(spotLight.shadow.camera)
  scene.add(spotLightCameraHelper)
```

ê·¸ë¦¼ì í€„ë¦¬í‹°ë¥¼ í–¥ìƒì‹œí‚¤ëŠ” ë°©ë²•ì€ directional light ì—ì„œ ì‚¬ìš©í–ˆë˜ í…Œí¬ë‹‰ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. `shadow.mapSize` ë¥¼ ë³€ê²½í•˜ì„¸ìš”

``` js
  spotLight.shadow.mapSize.width = 1024
  spotLight.shadow.mapSize.height = 1024
```

[SpotLight](https://threejs.org/docs/index.html#api/en/lights/SpotLight) ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, ë‚´ë¶€ì ìœ¼ë¡œ Three.js ëŠ” [PerspectiveCamera](https://threejs.org/docs/index.html#api/en/cameras/PerspectiveCamera) ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì´ê²ƒì€  fov í”„ë¡œí¼í‹° (`top`, `right`, `bottom`, `left` í”„ë¡œí¼í‹°ë¥¼ ëŒ€ì‹ ) ë¥¼ ë³€ê²½í•´ì•¼í•œë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.
ê·¸ë¦¼ìê°€ ì˜ë¦¬ì§€ ì•ŠëŠ” í•œì—ì„œ ê°€ëŠ¥í•œí•œ ì ì€ ê°ë„ë¥¼ ì°¾ì•„ì•¼í•©ë‹ˆë‹¤.

``` js
  spotLight.shadow.camera.fov = 30
  spotLight.shadow.camera.near = 1
  spotLight.shadow.camera.far = 6
```

<img src="./threejs_images/15-shadow-spotlightresult.PNG" width=400>
<img src="https://threejs-journey.xyz/assets/lessons/15/step-13.png" width=400>

# PointLight

ê·¸ë¦¼ìë¥¼ ì§€ì›í•˜ëŠ” ë§ˆì§€ë§‰ í´ë˜ìŠ¤ëŠ”, [PointLight](https://threejs.org/docs/index.html#api/en/lights/PointLight) ì…ë‹ˆë‹¤.

``` js
  // ğŸ‡ PointLight
  const pointLight = new THREE.PointLight(0xffffff, 0.3)
  pointLight.position.set(-1, 1, 0)

  pointLight.castShadow = true

  scene.add(pointLight)

  // point light ëŠ” ì—¬ëŸ¬êµ°ë°ì—ì„œ shadow ë¥¼ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŒ
  const pointLightCameraHelper = new THREE.CameraHelper(pointLight.shadow.camera)
  scene.add(pointLightCameraHelper)
```

<img src="./threejs_images/15-shadow-pointlightdefault.PNG" width=400>

ë³´ì‹œë‹¤ì‹œí”¼, camera helperëŠ” SpotLight ì²˜ëŸ¼ [PerspectiveCamera](https://threejs.org/docs/index.html#api/en/cameras/PerspectiveCamera) ì´ì§€ë§Œ, ì•„ë˜ë¥¼ í–¥í•´ìˆìŠµë‹ˆë‹¤. ì´ê²ƒì€ Three.js ê°€ PointLight ë¥¼ ìœ„í•œ shadow map ì„ í•¸ë“¤ë§í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

point light ê°€ ëª¨ë“  ë°©í–¥(360ë„)ì„ ë¹„ì¶”ê¸° ë•Œë¬¸ì—, Three.js ëŠ” cube shadow map ì„ ìƒì„±í•˜ê¸° ìœ„í•´ì„œ ê°ê°ì˜ 6 ë°©í–¥ì„ ëœë”ë§ í•´ì•¼í•©ë‹ˆë‹¤. ë³´ì´ëŠ” camera helperëŠ” ë§ˆì§€ë§‰ (ë°”ë‹¥ì„ í–¥í•˜ëŠ”) ëœë”ë§ì´ ëœ ì¹´ë©”ë¼ì˜ í¬ì§€ì…˜ì…ë‹ˆë‹¤.

ì´ ëª¨ë“  ëœë”ë§ì„ í•˜ëŠ”ê²ƒì€ í¼í¬ë¨¼ìŠ¤ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ë¦¼ìë¥¼ ìƒì„±í•˜ëŠ” ë„ˆë¬´ ë§ì€ PointLight ë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.

`mapSize`, `near`, `far` í”„ë¡œí¼í‹° ë§Œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

``` js
  pointLight.shadow.mapSize.width = 1024
  pointLight.shadow.mapSize.height = 1024
  pointLight.shadow.camera.near = 0.1
  pointLight.shadow.camera.far = 5
```

# Baking Shadows

Three.js shadowëŠ” scene ì´ ê°„ë‹¨í•  ê²½ìš° ì•„ì£¼ ìœ ìš©í•˜ì§€ë§Œ, ê·¸ë ‡ì§€ ì•Šì„ ê²½ìš°ì—ëŠ” ì§€ì €ë¶„í•´ì§‘ë‹ˆë‹¤.

ì¢‹ì€ ëŒ€ì•ˆì€ shadow ë¥¼ bake í•˜ëŠ” ê²ƒ ì…ë‹ˆë‹¤. ì´ì „ ê°•ì˜(14 Light) ì—ì„œ light ë¥¼ bake í•˜ëŠ” ê²ƒì—ëŒ€í•´ ë°°ì› ëŠ”ë°, ê·¸ê²ƒê³¼ ë§¤ìš° ë˜‘ê°™ìŠµë‹ˆë‹¤. Shadow ë¥¼ material ìœ„ì— ì ìš©ë˜ëŠ” textureì— ì…ë ¥í•˜ë©´ ë©ë‹ˆë‹¤.

ì‘ì„±ëœ ëª¨ë“  ì½”ë“œë¥¼ ì§€ìš°ëŠ” ëŒ€ì‹ ì—, `renderer.shadowMap` ì„ ë¹„í™œì„±í™” ì‹œì¼œì£¼ë©´ ë©ë‹ˆë‹¤.
``` js
  // ğŸ§Š
  renderer.shadowMap.enabled = false
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-18.png" width=400>

ì´ì œ ì½”ë“œ ë§¨ ìƒë‹¨ì— `/static/texture/backedShadow.jpg` íŒŒì¼ì„ [TextureLoader](https://threejs.org/docs/index.html#api/en/loaders/TextureLoader) ë¥¼ ì‚¬ìš©í•˜ì—¬ ê·¸ë¦¼ì texture ì— load í•´ì¤ë‹ˆë‹¤.

<img src="https://threejs-journey.xyz/assets/lessons/15/bakedShadow.jpg" width=300>

``` js  
  /**
  * Texutures
  */
  const textureLoaders = new THREE.TextureLoader()
  const bakedShadow = textureLoaders.load('/textures/bakedShadow.jpg')
  // console.log(bakedShadow)
```

ê·¸ë¦¬ê³ , [MeshStandardMaterial]() ì„ plane ì— ì‚¬ìš©í•˜ëŠ” ëŒ€ì‹ ì—, [MeshBasicMaterial]() ë¥¼ ì‚¬ìš©í•˜ì—¬ `backedShadow` ë¥¼ `map` ì„ í†µí•´ ì‚¬ìš©í•  ê²ƒ ì…ë‹ˆë‹¤.

``` js
  // plane
  const plane = new THREE.Mesh(
      new THREE.PlaneGeometry(5, 5),
      new THREE.MeshBasicMaterial({ map: bakedShadow })
  )
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-19.png" width=400>
<img src="https://threejs-journey.xyz/assets/lessons/15/step-20.png" width=400>

ê¹”ë”í•œ ê°€ì§œ ê·¸ë¦¼ìë¥¼ ë³¼ ìˆ˜ ìˆê¸´ í•˜ì§€ë§Œ, ë¬¸ì œëŠ” ì›€ì§ì¼ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒ ì…ë‹ˆë‹¤. ë§Œì•½ object (sphere, lights) ê°€ ì›€ì§ì¸ë‹¤ë©´, ê·¸ë¦¼ìëŠ” ì›€ì§ì´ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒ ì…ë‹ˆë‹¤.

# Baking shadows alternative

ì¡°ê¸ˆì€ ëœ ì§„ì§œê°™ì§€ë§Œ ë” ë™ì ì¸ ë°©ë²•ì€, ë” ê°„ë‹¨í•œ ê·¸ë¦¼ìë¥¼ sphere ë°‘ì—ì„œ, ê·¸ë¦¬ê³  plane ìœ„ì— ì–¹ìœ¼ë©´ ë©ë‹ˆë‹¤.

<img src="https://threejs-journey.xyz/assets/lessons/15/simpleShadow.jpg" width=300>

texture ëŠ” ê°„ë‹¨í•˜ê²Œ ë¹„ì–´ìˆì§€ë§Œ, í°ìƒ‰ ë¶€ë¶„ì€ ë³´ì´ëŠ”ë¶€ë¶„, ê²€ì€ìƒ‰ ë¶€ë¶„ì€ ë³´ì´ì§€ ì•ŠëŠ” ë¶€ë¶„ ì…ë‹ˆë‹¤. (ë§ˆìŠ¤í¬)

ë¨¼ì €, `map` ë˜ì–´ìˆë˜ ê·¸ë¦¼ìë¥¼ ë‹¤ì‹œì›ë˜ëŒ€ë¡œ ëŒë ¤ë†“ìŠµë‹ˆë‹¤.

``` js
  // plane
  const plane = new THREE.Mesh(
    new THREE.PlaneGeometry(5, 5),
    material
  )
```

ê·¸ëŸ° ë‹¤ìŒ, `/static/texture/backedShadow.jpg` ì— ìœ„ì¹˜í•œ ê·¸ë¦¼ì texture ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.
``` js
  /**
  * Texutures
  */
  const textureLoaders = new THREE.TextureLoader()
  const simpleShadow = textureLoaders.load('/textures/simpleShadow.jpg')
```

ê°„ë‹¨í•œ plane ì„ ìƒì„±í•´ì„œ ê·¸ë¦¼ìë¥¼ ë§Œë“¤ê²ƒ ì…ë‹ˆë‹¤. material ì€ shadow texture ì„ ì œì™¸í•˜ê³  `alphaMap` ì„ ì´ìš©í•˜ì—¬ ëª¨ë‘ ì–´ë‘¡ê²Œ ë³€í•©ë‹ˆë‹¤. (ì´ë¯¸ì§€ì—ì„œ í°ìƒ‰ ë¶€ë¶„ì€ ëª¨ë‘ `alphamMap`ìœ¼ë¡œ ì¸í•˜ì—¬ ì–´ë‘ì›Œì§‘ë‹ˆë‹¤) `transparent` ì„ `true` ë¡œ ë§Œë“¤ê³  `scene` ì— mesh ë¥¼ ë”í•˜ëŠ” ê²ƒì„ ìŠì§€ë§ˆì„¸ìš”.

``` js
  // ğŸ’£ baked fack shadow
  const sphereShadow = new THREE.Mesh(
      new THREE.PlaneBufferGeometry(1.5, 1.5),
      new THREE.MeshBasicMaterial({ color: 0x000000, transparent: true, alphaMap: simpleShadow })
  )

  sphereShadow.rotation.x = - Math.PI * 0.5
  sphereShadow.position.y = plane.position.y + 0.01
  scene.add(sphereShadow)
```

<img src="https://threejs-journey.xyz/assets/lessons/15/step-21.png" width=400>

ì§„ì§œ ê°™ì§€ëŠ” ì•Šì§€ë§Œ ì•„ì£¼ ì¢‹ì€ í¼í¬ë¨¼ìŠ¤ë¥¼ ê°€ì§€ê³ ìˆëŠ” ê·¸ë¦¼ìì…ë‹ˆë‹¤.

sphere ì—ê²Œ ì›€ì§ì´ëŠ” ì• ë‹ˆë©”ì´ì…˜ì„ ì¤€ë‹¤ë©´,  sphere ì˜ ìƒìŠ¹ì— ë”°ë¼ì„œ opacity ë¥¼ ë°”ê¿”ì£¼ê³ , ê°„ë‹¨í•˜ê²Œ ìƒì„±ëœ ê·¸ë¦¼ìë„ animate ì‹œì¼œì£¼ë©´ ë©ë‹ˆë‹¤.

``` js
  const clock = new THREE.Clock()

  const tick = () =>
  {
      const elapsedTime = clock.getElapsedTime()

      // Update the sphere
      sphere.position.x = Math.cos(elapsedTime) * 1.5
      sphere.position.z = Math.sin(elapsedTime) * 1.5
      sphere.position.y = Math.abs(Math.sin(elapsedTime * 3))

      // Update the shadow
      sphereShadow.position.x = sphere.position.x
      sphereShadow.position.z = sphere.position.z
      sphereShadow.material.opacity = (1 - sphere.position.y) * 0.3

      // ...
  }

  tick()
```

<video src="./threejs_images/15-shadow-animate.mp4"></video>

# Which technique to use

ê·¸ë¦¼ìë¥¼ í•¸ë“¤ë§ í•˜ëŠ” ì˜¬ë°”ë¥¸ í•´ê²°ì±…ì„ ì°¾ëŠ”ê²ƒì€ ì—¬ëŸ¬ë¶„ì—ê²Œ ë‹¬ë ¤ìˆìŠµë‹ˆë‹¤. í¼í¬ë¨¼ìŠ¤ì™€ í…Œí¬ë‹‰ì„ ì•Œê³ ìˆëŠ” í”„ë¡œì íŠ¸ì— ë”°ë¼ ë‹¬ë ¸ìŠµë‹ˆë‹¤. ì´ ëª¨ë“  í…Œí¬ë‹‰ì„ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤. 