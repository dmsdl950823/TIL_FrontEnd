# Connection

* HTTP 는 어떻게 TCP 커넥션을 사용하는가
* TCP 커넥션의 지연, 병목, 막힘
* 병렬 커넥션, keep-alive 커넥션, 커넥션 파이프라인을 활용한 HTTP 최적화
* 커넥션 관리를 위해 따라야할 규칙들


# TCP 커넥션

모든 HTTP 통신은 **패킷 교환 네트워크 프로토콜들의 계층화된 집합**인 **TCP/IP** 를 통해 이루어집니다. 

일단 커넥션이 맺어지면, client-server 간에 주고받는 메시지들은 손실/손상 등이 발생하지 않습니다.

TCP 는 HTTP 에게 신뢰할 만한 통신 방식을 제공하며, 데이터들은 순서에 맞게 정확히 전달됩니다.

```
  http://www.sample.com:80/power-tools.html
```

1. 브라우저가 `www.sample.com` 호스트명 추출
2. 브라우저가 이 호스트명에 대한 IP 주소를 찾음 (ex. `202.43.78.3`)
3. 브라우저가 포트 번호(`80`) 을 얻음
4. 브라우저가 `202.43.78.3:80` 으로 **TCP 커넥션을 생성**
5. 브라우저가 서버로 HTTP `GET` 요청 메시지를 보냄
6. 브라우저가 서버에서 온 HTTP 응답 메시지를 읽음
7. 브라우저가 커넥션을 끊음

## TCP 스트림

<img src="./images/httpconnection.png" width="600">

TCP 는 *IP 패킷*(*IP 데이터그램*) 이라고 불리는 작은 조각을 통해 데이터를 전송합니다.

HTTP 에 보안기능을 더한 HTTPS 는 TLS 혹은 SSL 이라 불리기도 하며 HTTP 와 TCP 사이에 있는 암호화 계층입니다.

HTTP 가 메시지를 전달하고자 할 경우, 현재 연결되어있는 TCP 커넥션을 통하여 순서대로 데이터를 전달합니다.

TCP 는 *세그먼트*라는 단위로 데이터 스트림을 잘게 나누고, 세그먼트를 *IP 패킷*이라고 불리는 봉투에 담아서, 인터넷을 통해 데이터를 통해 데이터를 전달합니다.

각 TCP 세그먼트는 하나의 IP 주소에서 다른 IP 주소로 IP 패킷에 담겨 전달됩니다. **IP 패킷**에는 아래 데이터를 포함합니다.

* **IP 패킷 헤더** :: 발신지, 목적지 IP 주소, 크기, 기타 플래그 를 포함  (보통 20 바이트)
* **TCP 세그먼트 헤더** :: TCP 포트번호, TCP 제어 플래그, 데이터의 순서/무결경 검사를 위한 숫자 값(보통 20 바이트)
* TCP 데이터 조각 (0 혹은 그 이상의 바이트)

## TCP 커넥션 유지하기